---
layout: post
title: "编译内核模块"
description: ""
category: 
tags: [Linux]
---
{% include JB/setup %}

Makefile
```
obj-m += procsview.o

KDIR := /lib/modules/$(shell uname -r)/build
PWD := $(shell pwd)

default:
        $(MAKE) -C $(KDIR) SUBDIRS=$(PWD) modules
```        

procsview.c
```
#include <linux/kernel.h>
#include <linux/module.h>
#include <linux/sched.h>
#include <linux/sched/signal.h>


extern struct task_struct init_task;

int init_module( void )
{
  /* Set up the anchor point */


        struct task_struct *task = &init_task;
        printk(KERN_ERR "Module init: Hello linux kernel.\n");

  /* Walk through the task list, until we hit the init_task again */
        for_each_process(task) {

                printk( KERN_INFO "*** %s [%d] parent %s\n",
        task->comm, task->pid, task->parent->comm );
  }

  return 0;

}

void cleanup_module( void )
{
  return;
}
```

```
make
insmod procsview.ko
cat  /var/log/syslog
```

```
rmmod procsview
```