---
title: 资源
toc: true
toc_sticky: true
tags:
- Spring
---

## 2.1 简介

 仅使用Java的`java.net.URL`并不能满足对各种底层资源的访问。

## 2.2   Resource接口

Resource接口定义：

```java
public interface Resource extends InputStreamSource {

    boolean exists();

    boolean isOpen();

    URL getURL() throws IOException;

    File getFile() throws IOException;

    Resource createRelative(String relativePath) throws IOException;

    String getFilename();

    String getDescription();
}

public interface InputStreamSource {

    InputStream getInputStream() throws IOException;
}
```

##2.3 内置Resource实现

* UrlResource

- ClassPathResource
- FileSystemResource
- ServletContextResource
- InputStreamResource
- ByteArrayResource

### 2.3.1 UrlResource

UrlResource 封装了` java.net.URL` 对象

### 2.3.2 `ClassPathResource`

`Resource`将在文件系统下的类路径解析为`java.io.File`，但不支持驻留在jar中，以及没有展开到文件系统（Servlet 引擎或其它环境）的类路径。为解决此类问题`Resource`实现总是支持解析为`java.net.URL`

### 2.3.3 `FileSystemResource`

内部使用`java.io.File`以及`java.nio.file.Path`处理，支持解析为`File`和`URL`

### 2.3.4 `PathResource`

`PathResource`只基于`java.nio.path.Path`，此场景下可与`FileSystemResource`相互替换，仅在`createRelative`方法有区别。

### 2.3.5 `ServletContextResource`

支持stream 访问和 URL 访问，以及支持在文件系统物理展开的资源作为`File` 访问

## 2.4 `ResourceLoader`接口

```java
public interface ResourceLoader {

    Resource getResource(String location);

    ClassLoader getClassLoader();
}
```

| Prefix     | Example                          | Explanation                                                  |
| :--------- | :------------------------------- | :----------------------------------------------------------- |
| classpath: | `classpath:com/myapp/config.xml` | Loaded from the classpath.                                   |
| file:      | `file:///data/config.xml`        | Loaded as a `URL` from the filesystem. See also [`FileSystemResource` Caveats](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources-filesystemresource-caveats). |
| https:     | `https://myserver/logo.png`      | Loaded as a `URL`.                                           |
| (none)     | `/data/config.xml`               | Depends on the underlying `ApplicationContext`.              |

## 2.5 `ResourcePatternResolver`接口

`ResourceLoader`的增强，用来解决路径的模式匹配

```java
public interface ResourcePatternResolver extends ResourceLoader {

    String CLASSPATH_ALL_URL_PREFIX = "classpath*:";

    Resource[] getResources(String locationPattern) throws IOException;
}	
```

`PathMatchingResourcePatternResolver`独立实现，可在`ApplicationContext`外部使用，使用`classpath*:`前缀或Ant风格表达式（使用Spring工具类AntPathMatcher）

## 2.6 `ResourceLoaderAware`接口

```java
public interface ResourceLoaderAware {

    void setResourceLoader(ResourceLoader resourceLoader);
}
```

## 2.7 资源作为依赖

```java
@Component
public class MyBean {

    private final Resource template;

    public MyBean(@Value("${template.path}") Resource template) {
        this.template = template;
    }

    // ...
}
```

## 2.8. Application上下文与资源路径

### 2.8.1. 初始化Application上下文

```java
ApplicationContext ctx = new ClassPathXmlApplicationContext(
    new String[] {"services.xml", "repositories.xml"}, MessengerService.class);
```

###2.8.2. 在Application 上下文初始化资源路径中使用通配符

##### Ant风格模式

```
/WEB-INF/*-context.xml
com/mycompany/**/applicationContext.xml
file:C:/some/path/*-context.xml
classpath:com/mycompany/**/applicationContext.xml
```

##### `classpath*:`前缀

```java
ApplicationContext ctx =
    new ClassPathXmlApplicationContext("classpath*:conf/appContext.xml");
```

### 2.8.3 `FileSystemResource`说明

`FileSystemResource`实例将所有位置路径都视为相对路径，以下等价：

```java
ApplicationContext ctx =
    new FileSystemXmlApplicationContext("conf/context.xml");

ApplicationContext ctx =
    new FileSystemXmlApplicationContext("/conf/context.xml");
```

