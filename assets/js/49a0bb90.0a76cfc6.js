"use strict";(self.webpackChunkyanpeipan_github_com=self.webpackChunkyanpeipan_github_com||[]).push([[890],{2046:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"redis/\u5e38\u89c1\u95ee\u9898/Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException","title":"Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException","description":"| \u573a\u666f                              | Lettuce\u5ba2\u6237\u7aef\u5f71\u54cd | \u4f18\u5316\u7b56\u7565 |","source":"@site/docs/redis/\u5e38\u89c1\u95ee\u9898/Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException.md","sourceDirName":"redis/\u5e38\u89c1\u95ee\u9898","slug":"/redis/\u5e38\u89c1\u95ee\u9898/Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException","permalink":"/docs/redis/\u5e38\u89c1\u95ee\u9898/Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException","draft":false,"unlisted":false,"editUrl":"https://github.com/yanpeipan/yanpeipan.github.com/tree/main/docs/redis/\u5e38\u89c1\u95ee\u9898/Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException.md","tags":[{"inline":true,"label":"Redis","permalink":"/docs/tags/redis"},{"inline":true,"label":"Lettuce","permalink":"/docs/tags/lettuce"},{"inline":true,"label":"RedisCommandTimeoutException","permalink":"/docs/tags/redis-command-timeout-exception"}],"version":"current","frontMatter":{"title":"Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException","tags":["Redis","Lettuce","RedisCommandTimeoutException"]},"sidebar":"redisSidebar","previous":{"title":"Lettuce\u8fde\u63a5Cluster\u96c6\u7fa4\u5b9e\u4f8b\u65f6\uff0c\u89c4\u683c\u53d8\u66f4\u7684\u5f02\u5e38\u5904\u7406","permalink":"/docs/redis/\u5e38\u89c1\u95ee\u9898/Lettuce\u8fde\u63a5Cluster\u96c6\u7fa4\u5b9e\u4f8b\u65f6\uff0c\u89c4\u683c\u53d8\u66f4\u7684\u5f02\u5e38\u5904\u7406"},"next":{"title":"JedisPool\u8fde\u63a5\u6c60\u53c2\u6570\u914d\u7f6e","permalink":"/docs/redis/Redis\u4f18\u5316/JedisPool\u8fde\u63a5\u6c60\u53c2\u6570\u914d\u7f6e"}}');var o=n(4848),c=n(8453);const s={title:"Lettuce\u95f4\u6b47\u6027\u53d1\u751f\uff1aRedisCommandTimeoutException",tags:["Redis","Lettuce","RedisCommandTimeoutException"]},r="\u95ee\u9898\u73b0\u8c61",d={},a=[{value:"1. \u914d\u7f6eTCP_USER_TIMEOUT",id:"1-\u914d\u7f6etcp_user_timeout",level:2},{value:"2. \u5b9a\u5236Lettuce",id:"2-\u5b9a\u5236lettuce",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"\u573a\u666f"}),(0,o.jsx)(t.th,{children:"Lettuce\u5ba2\u6237\u7aef\u5f71\u54cd"}),(0,o.jsx)(t.th,{children:"\u4f18\u5316\u7b56\u7565"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"\u7f51\u7edc\u6545\u969c10min+"}),(0,o.jsx)(t.td,{children:"15minClient\u624d\u80fd\u6062\u590d"}),(0,o.jsx)(t.td,{children:"\u57fa\u4e8eTCP_USER_TIMEOUT\u7684TCP\u63a2\u6d3b\u68c0\u6d4b"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{}),(0,o.jsx)(t.td,{}),(0,o.jsx)(t.td,{children:"\u5e94\u7528\u5c42\u6dfb\u52a0ping\u68c0\u6d4b\u5305\u7684\u65b9\u5f0f"})]})]})]}),"\n",(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"\u95ee\u9898\u73b0\u8c61",children:"\u95ee\u9898\u73b0\u8c61"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:"io.lettuce.core.RedisCommandTimeoutException: Command timed out after 1 minute(s)\n"})}),"\n",(0,o.jsx)(t.h1,{id:"\u95ee\u9898\u5206\u6790",children:"\u95ee\u9898\u5206\u6790"}),"\n",(0,o.jsxs)(t.p,{children:["\u5f53\u7f51\u7edc\u6545\u969c\u6216\u65ad\u7535\u7b49\u786c\u4ef6\u95ee\u9898\u5bfc\u81f4\u7684Redis Service\u5b95\u673a\uff0c\u6216\u8005SLB\u8d1f\u8f7d\u5747\u8861\u5bfc\u81f4\u540e\u7aef\u5730\u5740\u53d8\u5316\u65f6\uff0c\u672a\u8fd4\u56deRST\u5230Lettuce\u5ba2\u6237\u7aef\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u5728925.6\u79d2\uff08\u6839\u636etcp_retries2\uff09\u4e4b\u5185\u4f7f\u7528\u4e00\u4e2a\u65ad\u5f00\u7684\u8fde\u63a5\u3002\n\u53c2\u8003Lettuce\u793e\u533a\uff1a",(0,o.jsxs)(t.a,{href:"https://github.com/lettuce-io/lettuce-core/issues/2082",children:["Add support for disconnect on timeout to recover early from no\xa0",(0,o.jsx)(t.code,{children:"RST"}),"\xa0packet failures"]})]}),"\n",(0,o.jsx)(t.h1,{id:"\u89e3\u51b3\u65b9\u6848",children:"\u89e3\u51b3\u65b9\u6848"}),"\n",(0,o.jsx)(t.h2,{id:"1-\u914d\u7f6etcp_user_timeout",children:"1. \u914d\u7f6eTCP_USER_TIMEOUT"}),"\n",(0,o.jsx)(t.p,{children:"Lettuce\u63d0\u4f9b\u4e86TCP_USER_TIMEOUT\u914d\u7f6e\u53c2\u6570\uff0c\u53ef\u4ee5\u68c0\u6d4b\u8d85\u65f6\u65f6\u95f4\n\u6ce8\uff1a\u9700\u8981`4.1.65.Final\u7248\u672c\u53ca\u4ee5\u4e0a"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:"       // customize your netty\n        ClientResources clientResources = ClientResources.builder()\n                .nettyCustomizer(new NettyCustomizer() {\n                    @Override\n                    public void afterBootstrapInitialized(Bootstrap bootstrap) {\n                        if (EpollProvider.isAvailable()) {\n                            // TCP_USER_TIMEOUT >= TCP_KEEPIDLE + TCP_KEEPINTVL * TCP_KEEPCNT\n                            // https://blog.cloudflare.com/when-tcp-sockets-refuse-to-die/\n                            bootstrap.option(EpollChannelOption.TCP_USER_TIMEOUT, tcpUserTimeout);\n                        }\n                    }\n                })\n                .build();\n\n\n       // create your socket options\n       SocketOptions socketOptions = SocketOptions.builder()\n                .connectTimeout(connectTimeout)\n                .keepAlive(SocketOptions.KeepAliveOptions.builder()\n                        .enable()\n                        .idle(Duration.ofSeconds(5))\n                        .interval(Duration.ofSeconds(1))\n                        .count(3)\n                        .build())\n                .build();\n         \n"})}),"\n",(0,o.jsx)(t.h2,{id:"2-\u5b9a\u5236lettuce",children:"2. \u5b9a\u5236Lettuce"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:"LettuceConnectionFactory lettuceConnectionFactory = (LettuceConnectionFactory) redisTemplate.getConnectionFactory();\nlettuceConnectionFactory.setDatabase(2);\nredisTemplate.setConnectionFactory(lettuceConnectionFactory );\nlettuceConnectionFactory.resetConnection();\n"})})]})}function u(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var i=n(6540);const o={},c=i.createContext(o);function s(e){const t=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(c.Provider,{value:t},e.children)}}}]);